<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.0"/><style data-href="/styles.61537f05a54fca945a69.css" data-identity="gatsby-global-css">
/*!* http://meyerweb.com/eric/tools/css/reset/*/
/*!* HTML5 display-role reset for older browsers *!*/span{margin:0;padding:0}code[class*=language-],pre[class*=language-]{color:#ebdbb2;direction:ltr;font-family:Consolas,Monaco,Andale Mono,monospace;-webkit-hyphens:none;hyphens:none;line-height:1.5;margin:0;padding:0;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#7c6f64;color:#fbf1c7}pre[class*=language-]{margin:0;overflow:auto;padding:0}:not(pre)>code[class*=language-],pre[class*=language-]{background:#1d2021}:not(pre)>code[class*=language-]{border-radius:0;padding:0}.token.cdata,.token.comment,.token.prolog{color:#a89984}.token.atrule,.token.boolean,.token.delimiter,.token.important,.token.keyword,.token.selector{color:#fb4934}.token.attr-name,.token.operator,.token.punctuation{color:#a89984}.token.builtin,.token.doctype,.token.tag,.token.tag .punctuation{color:#fabd2f}.token.entity,.token.number,.token.symbol{color:#d3869b}.token.constant,.token.property,.token.variable{color:#fb4934}.token.char,.token.string{color:#b8bb26}.token.attr-value,.token.attr-value .punctuation{color:#a89984}.token.url{color:#b8bb26;text-decoration:underline}.token.function{color:#fabd2f}.token.regex{background:#b8bb26}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.inserted{background:#a89984}.token.deleted{background:#fb4934}pre.line-numbers:after,pre.line-numbers:before{display:inline!important}.gatsby-highlight-code-line{background-color:#2d2d2d;border-left:.25em solid #0fc;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:.8em}.gatsby-highlight{background-color:#1d2021;border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight pre[class*=language-].line-numbers{overflow:initial;padding-left:2.8em;padding:0 0 0 2.8em}.command-line-prompt>span:before{color:#999}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;text-align:right;-webkit-user-select:none;user-select:none}.command-line-prompt>span:before{content:" ";display:block;opacity:.7;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}.command-line-prompt>span[data-continuation-prompt]:before{content:attr(data-continuation-prompt)}.command-line span.token.output{opacity:.7}::-webkit-scrollbar{height:12px;width:12px}::-webkit-scrollbar-track{background:#222;border-radius:10px}::-webkit-scrollbar-thumb{background:#555;border:2px solid #222;border-radius:10px}::-webkit-scrollbar-thumb:hover{background:#888}::-webkit-scrollbar-horizontal{height:12px}*{scrollbar-color:#555 #222;scrollbar-width:thin}::selection{background-color:#4a4a4a;color:#fff}::-moz-selection{background-color:#4a4a4a;color:#fff}.background-pattern{height:100vh;overflow:hidden;position:relative;width:100vw}.grid-container{grid-gap:20px;display:grid;grid-template-columns:repeat(6,1fr);height:100%;width:100%}.icon-container{align-items:center;display:flex;justify-content:center}.truncated-text-three{-webkit-line-clamp:3;-webkit-box-orient:vertical;display:-webkit-box;line-height:1.5;min-height:4.5em;overflow:hidden;text-overflow:ellipsis}</style></head><body><div id="___gatsby"><style data-emotion="css-global 1gy5gt2">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:#e0e0e0;font-size:1.1rem;line-height:1.6;font-family:'Fira Code',monospace;font-weight:400;background-color:#121212;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#121212;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css s92abg">.css-s92abg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100vh;}</style><div class="MuiBox-root css-s92abg"><style data-emotion="css bzqdkj">.css-bzqdkj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#00ffcc;--AppBar-color:#000000;background-color:#1a1a1a;color:#e0e0e0;box-shadow:0 2px 4px rgba(0, 0, 0, 0.5);}</style><style data-emotion="css gdvm1s">.css-gdvm1s{background-color:#1b1b1b;color:#e0e0e0;-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:var(--Paper-shadow);background-image:var(--Paper-overlay);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;--AppBar-background:#00ffcc;--AppBar-color:#000000;background-color:#1a1a1a;color:#e0e0e0;box-shadow:0 2px 4px rgba(0, 0, 0, 0.5);}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-gdvm1s" style="--Paper-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);--Paper-overlay:linear-gradient(rgba(255, 255, 255, 0.092), rgba(255, 255, 255, 0.092))"><style data-emotion="css awgou1">.css-awgou1{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-awgou1{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-awgou1{min-height:48px;}}}@media (min-width:600px){.css-awgou1{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-awgou1"><a style="text-decoration:none;margin-right:16px" href="/"><style data-emotion="css 1wvotl7">.css-1wvotl7{margin:0;font-family:'Fira Code',monospace;font-weight:500;font-size:1.25rem;line-height:1.6;color:#e0e0e0;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-text-decoration:none;text-decoration:none;}</style><div class="MuiTypography-root MuiTypography-h6 css-1wvotl7">&gt;&gt; manjana.dev</div></a><style data-emotion="css 13tqxrv">@media (min-width:0px){.css-13tqxrv{display:none;}}@media (min-width:900px){.css-13tqxrv{display:block;}}</style><div class="MuiBox-root css-13tqxrv"><style data-emotion="css 5ww3gd">.css-5ww3gd{text-transform:none;font-weight:500;font-family:'Fira Code',monospace;font-size:0.875rem;line-height:1.75;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#424242;border-radius:6px;padding:8px 16px;box-shadow:none;}.css-5ww3gd:hover{-webkit-text-decoration:none;text-decoration:none;}.css-5ww3gd.Mui-disabled{color:rgba(255, 255, 255, 0.3);}@media (hover: hover){.css-5ww3gd:hover{--variant-containedBg:#616161;--variant-textBg:rgba(224, 224, 224, 0.08);--variant-outlinedBg:rgba(224, 224, 224, 0.08);}}</style><style data-emotion="css 1tbrjfc">.css-1tbrjfc{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-transform:none;font-weight:500;font-family:'Fira Code',monospace;font-size:0.875rem;line-height:1.75;min-width:64px;padding:6px 16px;border:0;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:6px 8px;color:var(--variant-textColor);background-color:var(--variant-textBg);color:inherit;border-color:currentColor;--variant-containedBg:#424242;border-radius:6px;padding:8px 16px;box-shadow:none;}.css-1tbrjfc::-moz-focus-inner{border-style:none;}.css-1tbrjfc.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1tbrjfc{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1tbrjfc:hover{-webkit-text-decoration:none;text-decoration:none;}.css-1tbrjfc.Mui-disabled{color:rgba(255, 255, 255, 0.3);}@media (hover: hover){.css-1tbrjfc:hover{--variant-containedBg:#616161;--variant-textBg:rgba(224, 224, 224, 0.08);--variant-outlinedBg:rgba(224, 224, 224, 0.08);}}</style><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-1tbrjfc" tabindex="0" mx="2" href="/">Home</a><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-1tbrjfc" tabindex="0" mx="2" href="/projects/">Projects</a><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-1tbrjfc" tabindex="0" mx="2" href="/blog/">Writings</a><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-1tbrjfc" tabindex="0" mx="2" href="/contact/">Contact</a></div><style data-emotion="css eiytc8">.css-eiytc8{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:#fff;-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(255, 255, 255, 0.08);margin-right:-12px;color:inherit;margin-left:auto;}.css-eiytc8:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.css-eiytc8:hover{background-color:transparent;}}.css-eiytc8.Mui-disabled{background-color:transparent;color:rgba(255, 255, 255, 0.3);}@media (min-width:900px){.css-eiytc8{display:none;}}</style><style data-emotion="css 1t57qrs">.css-1t57qrs{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;color:#fff;-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;--IconButton-hoverBg:rgba(255, 255, 255, 0.08);margin-right:-12px;color:inherit;margin-left:auto;}.css-1t57qrs::-moz-focus-inner{border-style:none;}.css-1t57qrs.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1t57qrs{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1t57qrs:hover{background-color:var(--IconButton-hoverBg);}@media (hover: none){.css-1t57qrs:hover{background-color:transparent;}}.css-1t57qrs.Mui-disabled{background-color:transparent;color:rgba(255, 255, 255, 0.3);}@media (min-width:900px){.css-1t57qrs{display:none;}}</style><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeEnd MuiIconButton-sizeMedium css-1t57qrs" tabindex="0" type="button" aria-label="menu"><style data-emotion="css q7mezt">.css-q7mezt{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;fill:currentColor;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-q7mezt" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"></path></svg></button><style data-emotion="css 14yoxd">.css-14yoxd{z-index:1200;}</style></div></header><style data-emotion="css gcpdnc">.css-gcpdnc{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;padding:16px;}</style><div class="MuiBox-root css-gcpdnc"><style data-emotion="css 9wvnva">.css-9wvnva{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-9wvnva{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-9wvnva{max-width:1200px;}}</style><div class="MuiContainer-root MuiContainer-maxWidthLg css-9wvnva"><style data-emotion="css 1ct1r0b">.css-1ct1r0b{margin:0;font-size:1.1rem;line-height:1.6;color:#e0e0e0;font-family:'Fira Code',monospace;font-weight:400;margin-bottom:16px;color:#e0e0e0;font-size:1.1rem;line-height:1.6;margin-bottom:16px;}</style><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-1ct1r0b">In this brief article which features a comprehensive bash script for setting up an SMTP mailserver...</p>
<style data-emotion="css vxar8u">.css-vxar8u{margin:0;font-size:2.5rem;font-weight:700;color:#00ffcc;font-family:'Fira Code',monospace;line-height:1.167;margin-bottom:0.35em;color:#00ffcc;text-shadow:0 0 15px rgba(0, 255, 204, 0.75);font-family:'Fira Code',monospace;font-size:3rem;font-weight:900;}</style><h1 class="MuiTypography-root MuiTypography-h1 MuiTypography-gutterBottom css-vxar8u">The Script</h1><style data-emotion="css gras7g">.css-gras7g{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(255, 255, 255, 0.12);border-bottom-width:thin;background:linear-gradient(to right, #ffcc00  , #ff4081);height:2px;border-radius:1px;margin:16px 0;background:linear-gradient(to right, #ff4081, #ffcc00);height:2px;border-radius:4px;margin:20px 0;box-shadow:0 0 10px rgba(255, 64, 129, 0.6);}</style><hr class="MuiDivider-root MuiDivider-fullWidth css-gras7g"/>
<span><div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">DOMAIN</span><span class="token operator">=</span><span class="token string">"greenpower.monster"</span>
<span class="token assign-left variable">SMTP_SUBDOMAIN</span><span class="token operator">=</span><span class="token string">"smtp"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"A record for domain is:"</span>
<span class="token function">dig</span> +short <span class="token variable">${DOMAIN}</span>

adduser <span class="token parameter variable">--gecos</span> <span class="token string">"Noreply"</span> --disabled-password noreply <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"noreply:Kode1234!"</span> <span class="token operator">|</span> chpasswd

<span class="token builtin class-name">export</span> <span class="token assign-left variable">DEBIAN_FRONTEND</span><span class="token operator">=</span>noninteractive
<span class="token builtin class-name">echo</span> <span class="token string">"postfix postfix/main_mailer_type select Internet"</span> <span class="token operator">|</span> debconf-set-selections
<span class="token builtin class-name">echo</span> <span class="token string">"postfix postfix/mailname string <span class="token variable">${SMTP_SUBDOMAIN}</span>.<span class="token variable">${DOMAIN}</span>"</span> <span class="token operator">|</span> debconf-set-selections


<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> upgrade -y<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Failed to update packages. Exiting."</span>
<span class="token keyword">fi</span>

<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> postfix dovecot-core dovecot-imapd certbot python3-certbot-nginx ufw <span class="token function">lsof</span> rsyslog mailutils dnsutils
<span class="token function">touch</span> /var/log/mail.log
<span class="token function">touch</span> /var/log/mail.err
<span class="token function">chmod</span> <span class="token number">640</span> /var/log/mail.log
<span class="token function">chmod</span> <span class="token number">640</span> /var/log/mail.err

<span class="token builtin class-name">echo</span> <span class="token string">"Configuring Postfix..."</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"myhostname = <span class="token variable">${SMTP_SUBDOMAIN}</span>.<span class="token variable">${DOMAIN}</span>"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"mydomain = <span class="token variable">${DOMAIN}</span>"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"myorigin = <span class="token variable">${DOMAIN}</span>"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"mydestination = localhost, localhost.<span class="token variable">${DOMAIN}</span>, <span class="token variable">${DOMAIN}</span>, <span class="token variable">${SMTP_SUBDOMAIN}</span>.<span class="token variable">${DOMAIN}</span>"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"inet_interfaces = all"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"inet_protocols = ipv4"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"mynetworks = 127.0.0.0/8"</span>
<span class="token comment"># shellcheck disable=SC2154</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"relay_domains = <span class="token variable">$mydomain</span>"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_tls_protocols = !SSLv2, !SSLv3"</span>  <span class="token comment"># Disable insecure protocols</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_tls_auth_only = no"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_tls_received_header = yes"</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/postfix/relay_domains</span>
<span class="token variable">${DOMAIN}</span> OK
gmail.com OK
protonmail.com OK
EOF</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/postfix/master.cf</span>
submission inet n       -       y       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_recipient_restrictions=permit_sasl_authenticated,reject
EOF</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Configuring Dovecot... (without SSL paths initially)"</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/dovecot/dovecot.conf</span>
mail_location = maildir:~/Maildir

protocols = imap
auth_mechanisms = plain login

service imap-login {
   inet_listener imap {
      port = 0  # Disable plain IMAP
   }
   inet_listener imaps {
      port = 993
      ssl = yes
   }
}
service auth {
   unix_listener /var/spool/postfix/private/auth {
      mode = 0660
      user = postfix
      group = postfix
   }
}

passdb {
  driver = pam
}

userdb {
  driver = passwd
}
EOF</span>

<span class="token keyword">if</span> <span class="token function">lsof</span> <span class="token parameter variable">-i</span> :80<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Port 80 is in use. Stopping the process using it..."</span>
    <span class="token function">fuser</span> <span class="token parameter variable">-k</span> <span class="token number">80</span>/tcp
<span class="token keyword">fi</span>


<span class="token builtin class-name">echo</span> <span class="token string">"Obtaining Let's Encrypt certificates using --standalone web server"</span>
<span class="token keyword">if</span> <span class="token operator">!</span> certbot certonly <span class="token parameter variable">--standalone</span> --non-interactive --agree-tos <span class="token parameter variable">--email</span> ta.privat@protonmail.com <span class="token parameter variable">-d</span> <span class="token variable">${DOMAIN}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Failed to obtain Let's Encrypt certificates. Please check the logs."</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> /etc/letsencrypt/live/<span class="token variable">${DOMAIN}</span>/fullchain.pem <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> /etc/letsencrypt/live/<span class="token variable">${DOMAIN}</span>/privkey.pem <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"SSL certificate files do not exist. Please check the certificate generation step."</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Updating Dovecot configuration with SSL paths..."</span> <span class="token comment"># CHEKC THIS!</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">>></span> /etc/dovecot/dovecot.conf</span>
ssl_cert = &lt;/etc/letsencrypt/live/<span class="token variable">${DOMAIN}</span>/fullchain.pem
ssl_key = &lt;/etc/letsencrypt/live/<span class="token variable">${DOMAIN}</span>/privkey.pem
EOF</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Configuring Dovecot for SASL..."</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_sasl_type = dovecot"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_sasl_path = private/auth"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_sasl_local_domain = <span class="token variable">${DOMAIN}</span>"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_sasl_auth_enable = yes"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_recipient_restrictions = permit_sasl_authenticated, reject_unauth_destination"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_sender_restrictions = permit_mynetworks, permit_sasl_authenticated, reject"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_tls_cert_file = /etc/letsencrypt/live/<span class="token variable">${DOMAIN}</span>/fullchain.pem"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_tls_key_file = /etc/letsencrypt/live/<span class="token variable">${DOMAIN}</span>/privkey.pem"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"smtpd_use_tls = yes"</span>
postconf <span class="token parameter variable">-e</span> <span class="token string">"debug_peer_list = localhost"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Restarting Dovecot with new SSL configuration..."</span>
<span class="token keyword">if</span> <span class="token operator">!</span> systemctl restart dovecot<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Failed to restart Dovecot. Exiting."</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Restarting Postfix..."</span>
<span class="token keyword">if</span> <span class="token operator">!</span> systemctl restart postfix<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Failed to restart Postfix. Exiting."</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Configuring UFW firewall rules..."</span>
ufw allow <span class="token number">25</span>/tcp  <span class="token comment"># SMTP</span>
ufw allow <span class="token number">465</span>/tcp <span class="token comment"># SMTPS</span>
ufw allow <span class="token number">587</span>/tcp <span class="token comment"># Submission</span>
ufw allow <span class="token number">993</span>/tcp <span class="token comment"># IMAPS</span>
<span class="token keyword">if</span> <span class="token operator">!</span> ufw status <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">"Status: active"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    ufw <span class="token builtin class-name">enable</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Creating user noreply@<span class="token variable">${DOMAIN}</span>..."</span>
<span class="token comment">#doveadm user add noreply@${DOMAIN} Kode1234!</span>
doveadm user <span class="token function">add</span> noreply

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/noreply/Maildir/<span class="token punctuation">{</span>cur,new,tmp<span class="token punctuation">}</span>
<span class="token function">chown</span> <span class="token parameter variable">-R</span> noreply:noreply /home/noreply/Maildir

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/mail/noreply
<span class="token function">chown</span> noreply:noreply /var/mail/noreply
<span class="token builtin class-name">echo</span> <span class="token string">"mail_location = maildir:/var/mail/noreply"</span> <span class="token operator">>></span> /etc/dovecot/conf.d/10-mail.conf

<span class="token builtin class-name">echo</span> <span class="token string">"Mail server setup completed successfully!"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"This is a test email."</span> <span class="token operator">|</span> mail <span class="token parameter variable">-s</span> <span class="token string">"Test Email Subject"</span> noreply@<span class="token variable">${DOMAIN}</span>
<span class="token function">less</span> /var/mail/noreply
<span class="token comment"># postmap /etc/postfix/relay_domains</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Reloading Postfix and Dovecot..."</span>
systemctl reload postfix
systemctl reload dovecot</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></span></div></div><style data-emotion="css twmhfa">.css-twmhfa{padding:16px;margin-top:32px;background-color:#1b1b1b;text-align:center;}</style><footer class="MuiBox-root css-twmhfa" style="padding:0.7rem 0"><style data-emotion="css 1vtwbm4">.css-1vtwbm4{margin:0;font-family:'Fira Code',monospace;font-weight:400;font-size:0.875rem;line-height:1.43;color:#b3b3b3;}</style><p class="MuiTypography-root MuiTypography-body2 css-1vtwbm4">© <!-- -->2024<!-- --> manjana/blue-hexagon — all rights reserved.</p><p class="MuiTypography-root MuiTypography-body2 css-1vtwbm4">Connect with me on <style data-emotion="css 1j7qjdd">.css-1j7qjdd{-webkit-text-decoration:none;text-decoration:none;}</style><style data-emotion="css 19rvrvc">.css-19rvrvc{margin:0;font:inherit;line-height:inherit;letter-spacing:inherit;color:#00ffcc;-webkit-text-decoration:none;text-decoration:none;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-19rvrvc" target="_blank" rel="noreferrer" href="https://github.com/blue-hexagon">GitHub</a> or <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone css-19rvrvc" target="_blank" rel="noreferrer" href="https://www.linkedin.com/in/your-profile">LinkedIn</a>.</p></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/setup-a-postfix-mailserver/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-14ab39b45a0d35132b00.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-d4da4b5e95979657ffee.js\"],\"component---src-pages-blog-components-blog-card-js\":[],\"component---src-pages-blog-components-categories-js\":[],\"component---src-pages-blog-components-hidden-search-forms-helper-js\":[\"/component---src-pages-blog-components-hidden-search-forms-helper-js-9569d1ad9e2f92f77b1f.js\"],\"component---src-pages-blog-index-js\":[],\"component---src-pages-blog-setup-a-postfix-mailserver-mdx\":[\"/component---src-pages-blog-setup-a-postfix-mailserver-mdx-12601d26f0c409160d42.js\"],\"component---src-pages-blog-ten-minutes-of-unicode-mdx\":[\"/component---src-pages-blog-ten-minutes-of-unicode-mdx-3539e7b275a01fb6eb44.js\"],\"component---src-pages-contact-js\":[\"/component---src-pages-contact-js-80e0b1d818350a599eb3.js\"],\"component---src-pages-index-js\":[],\"component---src-pages-projects-icon-list-js\":[],\"component---src-pages-projects-index-js\":[]}";
          </script>
        <script>window.___webpackCompilationHash="1f91c93a65a86dc83c8a";</script><script src="/webpack-runtime-69fd39cfd6a2c3fd5919.js" async></script><script src="/framework-072427fe94061b274f50.js" async></script><script src="/d9067523-c64e33ba2b4f007a4697.js" async></script><script src="/cb355538-e4a2609b9c13d908b66a.js" async></script><script src="/d3820dff-551e8d8846605ec5893a.js" async></script><script src="/app-14ab39b45a0d35132b00.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>